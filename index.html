<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=10.0">
    <title>Extreme Hangman</title>
    <style>
        /* General Styles */
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            height: 100vh;
            margin: 0;
            background-color: #f4f4f4;
            padding: 10px;
            touch-action: manipulation;
        }
        
        #game-container {
            text-align: center;
            max-width: 90%;
            background-color: #ffffff;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-size: calc(1.2rem + 1vw); /* Smaller title */
            margin-top: 5px; /* Reduce top margin */
            margin-bottom: 15px;
        }

        #label-word-wrapper {
            display: flex;
            flex-direction: column;
            width: 100%;
            margin-bottom: 10px;
        }

        .word-row {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            margin: 5px 0;
            padding-bottom: 5px;
            border-bottom: 1px solid #ddd;
        }

        .word-label {
            font-weight: bold;
            font-size: calc(1rem + 0.8vw);
            text-align: left;
            margin-bottom: 5px;
        }

        .word-display {
            font-size: calc(1rem + 0.8vw); 
            letter-spacing: 1px;
            text-align: left;
        }

        .hidden-underscore {
            color: #f4f4f4;
        }

        .guessed-word {
            color: green;
        }

        .missing-letter {
            color: red;
        }

        .button {
            padding: 8px;
            margin: 2px;
            font-size: calc(0.9rem + 1vw);
            cursor: pointer;
            background-color: #3498db;
            color: #fff;
            border: none;
            border-radius: 5px;
            transition: background-color 0.2s;
        }

        .button:hover {
            background-color: #2980b9;
        }

        .disabled {
            background-color: #ddd;
            cursor: not-allowed;
        }

        .incorrect {
            background-color: #e74c3c;
        }

        #letter-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 100%;
            margin: 10px 0;
        }

        .message {
            font-size: calc(0.8em + 1vw);
            color: #555;
        }

        #new-game {
            margin: 15px;
            padding: 8px;
            font-size: calc(0.8em + 1vw);
            background-color: #2ecc71;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        #new-game:hover {
            background-color: #27ae60;
        }

        #definitions-container {
            margin-top: 10px;
            text-align: left;
        }

        .definition-item {
            font-size: calc(0.9rem + 0.6vw);
            color: #333;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>Extreme Hangman</h1>
        
        <div id="label-word-wrapper"></div> <!-- Wrapper for words and labels -->
        
        <p class="message" id="game-message">Please wait, generating random words. This can take about 10 seconds...</p>
        <div id="letter-buttons"></div>
        <button id="new-game">New Game</button>
        <p class="message">Lives remaining: <span id="lives-count">9</span></p>
        <p class="message">Incorrect letters: <span id="incorrect-list"></span></p>
        <div id="definitions-container"></div> <!-- Container for definitions -->
    </div>

    <script>
        const maxWords = 5;
        const livesPerWord = [9, 7, 5, 3];
        const displayLength = 20;
        let selectedWords = [];
        let lives;
        let incorrectLetters = [];
        let gameEnded = false;

        async function fetchWordsWithDefinitions() {
            document.getElementById("game-message").textContent = "Please wait, looking up words. This can take about 10 seconds...";
            document.getElementById("definitions-container").innerHTML = ""; // Clear previous definitions
            selectedWords = [];
            while (selectedWords.length < maxWords) {
                const word = await fetchRandomWord();
                const hasDefinition = await checkForDefinition(word);
                if (hasDefinition) {
                    selectedWords.push({
                        word: word,
                        display: Array(displayLength).fill("\u00A0"),
                        solved: false,
                        revealedStart: -1,
                        revealedEnd: -1,
                        offset: Math.floor(Math.random() * (displayLength - word.length + 1)),
                        definition: null
                    });
                }
            }
            initializeGame();
            document.getElementById("game-message").textContent = "Click a letter to start guessing!";
        }

        async function fetchRandomWord() {
            const response = await fetch('https://random-word-api.herokuapp.com/word?number=1');
            const words = await response.json();
            return words[0];
        }

        async function checkForDefinition(word) {
            try {
                const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
                const data = await response.json();
                return data[0]?.meanings[0]?.definitions[0]?.definition && data[0]?.meanings[0]?.definitions[0]?.definition !== "No Definitions Found";
            } catch {
                return false;
            }
        }

        function initializeGame() {
            gameEnded = false;
            lives = livesPerWord[Math.min(selectedWords.length - 1, livesPerWord.length - 1)];
            incorrectLetters = [];
            setupLabels();
            updateDisplay();
            createLetterButtons();
        }

        function setupLabels() {
            const labelWordWrapper = document.getElementById("label-word-wrapper");
            labelWordWrapper.innerHTML = "";
            selectedWords.forEach((_, index) => {
                const rowDiv = document.createElement("div");
                rowDiv.className = "word-row";

                const labelDiv = document.createElement("div");
                labelDiv.className = "word-label";
                labelDiv.textContent = `Word ${index + 1}:`;

                const wordDiv = document.createElement("div");
                wordDiv.className = "word-display";
                wordDiv.id = `word-${index}`; // Unique ID for each word display

                rowDiv.appendChild(labelDiv);
                rowDiv.appendChild(wordDiv);
                labelWordWrapper.appendChild(rowDiv);
            });
        }

        function getDisplayWord(obj) {
            let displayWord = [...obj.display];
            for (let i = 0; i < obj.word.length; i++) {
                const position = obj.offset + i;
                if (obj.display[position] !== "\u00A0") {
                    displayWord[position] = obj.display[position];
                } else if (i === obj.revealedStart || i === obj.revealedEnd) {
                    displayWord[position] = obj.word[i];
                } else if (obj.revealedStart !== -1 && obj.revealedEnd !== -1 && i > obj.revealedStart && i < obj.revealedEnd) {
                    displayWord[position] = "_";
                } else {
                    displayWord[position] = "\u00A0";
                }
            }
            return displayWord.map((char, idx) =>
                char === "_" && (idx <= obj.offset + obj.revealedStart || idx >= obj.offset + obj.revealedEnd)
                    ? `<span class="hidden-underscore">_</span>`
                    : char
            ).join(" ");
        }

        function updateDisplay() {
            selectedWords.forEach((obj, index) => {
                const wordDiv = document.getElementById(`word-${index}`);
                wordDiv.innerHTML = getDisplayWord(obj);

                if (obj.solved || gameEnded) {
                    wordDiv.classList.add("guessed-word");
                    wordDiv.title = obj.definition || "Loading definition...";
                    if (!obj.definition) fetchWordDefinition(obj.word, wordDiv, index);
                }
            });

            document.getElementById("lives-count").textContent = lives;
            document.getElementById("incorrect-list").textContent = incorrectLetters.join(", ");
        }

        async function fetchWordDefinition(word, wordDiv, index) {
            try {
                const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
                const data = await response.json();
                const definition = data[0]?.meanings[0]?.definitions[0]?.definition || "Definition not found.";
                selectedWords.find(w => w.word === word).definition = definition;
                wordDiv.title = definition;
                displayDefinition(index, word, definition); // Display definition at the bottom
            } catch {
                wordDiv.title = "Definition not found.";
            }
        }

        function displayDefinition(index, word, definition) {
            const definitionsContainer = document.getElementById("definitions-container");
            const definitionItem = document.createElement("div");
            definitionItem.className = "definition-item";
            definitionItem.textContent = `Word ${index + 1} (${word}): ${definition}`;
            definitionsContainer.appendChild(definitionItem);
        }

        function guessLetter(letter, button) {
            button.disabled = true;
            button.classList.add("disabled");
            let found = false;

            selectedWords.forEach((obj) => {
                if (!obj.solved) {
                    const word = obj.word;
                    const display = obj.display;
                    const firstMatch = word.indexOf(letter);
                    const lastMatch = word.lastIndexOf(letter);

                    if (firstMatch !== -1) {
                        found = true;
                        obj.revealedStart = obj.revealedStart === -1 ? firstMatch : Math.min(obj.revealedStart, firstMatch);
                        obj.revealedEnd = Math.max(obj.revealedEnd, lastMatch);

                        for (let i = 0; i < word.length; i++) {
                            if (word[i] === letter) {
                                display[obj.offset + i] = letter;
                            }
                        }

                        const allLettersGuessed = word.split("").every((char, idx) => display[obj.offset + idx] === char);
                        if (allLettersGuessed) obj.solved = true;
                    }
                }
            });

            if (!found) {
                if (!incorrectLetters.includes(letter)) {
                    incorrectLetters.push(letter);
                    lives--;
                    button.classList.add("incorrect");
                }
            }

            updateDisplay();
            checkGameStatus();
        }

        function checkGameStatus() {
            const allWordsSolved = selectedWords.every(obj => obj.solved);
            if (allWordsSolved) {
                document.getElementById("game-message").textContent = "You Win! All words revealed!";
                disableAllButtons();
            } else if (lives <= 0) {
                document.getElementById("game-message").textContent = "You Lose! The words were: " +
                    selectedWords.map(obj => obj.word).join(", ");
                disableAllButtons();
                gameEnded = true;
                revealAllWords();
                updateDisplay();
            }
        }

        function revealAllWords() {
            selectedWords.forEach((obj, index) => {
                for (let i = 0; i < obj.word.length; i++) {
                    const position = obj.offset + i;
                    if (obj.display[position] === "\u00A0") {
                        obj.display[position] = `<span class="missing-letter">${obj.word[i]}</span>`;
                    }
                }
                if (obj.definition) {
                    displayDefinition(index, obj.word, obj.definition);
                }
            });
        }

        function disableAllButtons() {
            const buttons = document.querySelectorAll("#letter-buttons button");
            buttons.forEach(button => button.disabled = true);
        }

        function createLetterButtons() {
            const letterButtons = document.getElementById("letter-buttons");
            letterButtons.innerHTML = "";
            const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            for (let letter of alphabet) {
                const button = document.createElement("button");
                button.textContent = letter;
                button.classList.add("button");
                button.addEventListener("click", () => guessLetter(letter.toLowerCase(), button));
                letterButtons.appendChild(button);
            }
        }

        document.getElementById("new-game").addEventListener("click", fetchWordsWithDefinitions);
        document.addEventListener("DOMContentLoaded", fetchWordsWithDefinitions);
    </script>
</body>
</html>
